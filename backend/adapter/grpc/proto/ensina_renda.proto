syntax = "proto3";

package ensina_renda;

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/timestamp.proto";

option go_package = ".;grpc";

service EnsinaRendaService {
    rpc CadastrarAluno(CadastrarAlunoRequest) returns (CadastrarAlunoResponse) {
        option (google.api.http) = {    
            post: "/v1/aluno"
            body: "*"
        };
    }

    rpc VerificarAluno(VerificarAlunoRequest) returns (VerificarAlunoResponse) {
        option (google.api.http) = {    
            get: "/v1/aluno/{email}/{senha}"
        };
    }

    rpc RealizarLogin(RealizarLoginRequest) returns (RealizarLoginResponse){
        option (google.api.http) = {
            post: "/v1/aluno/auth"
            body: "*"
        };
    }

    rpc ConcluirAula(ConcluirAulaRequest) returns (ConcluirAulaResponse) {
        option (google.api.http) = {    
            post: "/v1/aluno/{id_usuario}/aula/{id_aula}"
            body: "*"
        };
    }

    rpc ConcluirModulo(ConcluirModuloRequest) returns (ConcluirModuloResponse) {
        option (google.api.http) = {    
            post: "/v1/aluno/{id_usuario}/modulo/{id_modulo}"
            body: "*"
        };
    }

    rpc ListarModuloAulas(ListarModuloAulasRequest) returns (ListarModuloAulasResponse){
        option (google.api.http) = {
            get: "/v1/aluno/aulas"
        };
    }

    rpc GetUsuarioPeloEmail(GetUsuarioPeloEmailRequest) returns (GetUsuarioPeloEmailResponse){
        option (google.api.http) = {
            get: "/v1/usuario/{email}"
        };
    }

    rpc AtualizarSenha(AtualizarSenhaRequest) returns (AtualizarSenhaResponse) {
        option (google.api.http) = {
            put: "/v1/aluno/senha"
            body: "*"
        };
    }

     rpc GerarProva(GerarProvaRequest) returns (GerarProvaResponse) {
        option (google.api.http) = {
            post: "/v1/prova/gerar"
            body: "*"
        };
    }

    rpc GetProvaGerada(GetProvaGeradaRequest) returns (GetProvaGeradaResponse){
        option (google.api.http) = {
            get: "/v1/prova/gerada/{id_modulo}"
        };
    }

     rpc CorrigirProva(CorrigirProvaRequest) returns (CorrigirProvaResponse) {
        option (google.api.http) = {
            post: "/v1/prova/corrigir"
            body: "*"
        };
    }

    rpc GetProvaCorrigida(GetProvaCorrigidaRequest) returns (GetProvaCorrigidaResponse){
        option (google.api.http) = {
            get: "/v1/prova/corrigida/{id_modulo}"
        };
    }
}

message CadastrarAlunoRequest {
    string nome = 1 [(google.api.field_behavior) = REQUIRED];
    string email = 2 [(google.api.field_behavior) = REQUIRED];
    string senha = 3 [(google.api.field_behavior) = REQUIRED];
    string data_nascimento = 4 [(google.api.field_behavior) = REQUIRED];
}

message CadastrarAlunoResponse {
    string mensagem = 1;
    bool sucesso = 2;
}


message VerificarAlunoRequest{
    // Aqui é o hash SHA-256 do email
    string email = 1 [(google.api.field_behavior) = REQUIRED];
    // Aqui é o hash SHA-256 da senha
    string senha = 2 [(google.api.field_behavior) = REQUIRED];
}

message VerificarAlunoResponse {
    string mensagem = 1;
    bool sucesso = 2;
}

message RealizarLoginRequest{
    // Aqui é o hash SHA-256 do email
    string email = 1 [(google.api.field_behavior) = REQUIRED];
    // Aqui é o hash SHA-256 da senha
    string senha = 2 [(google.api.field_behavior) = REQUIRED];
}

message RealizarLoginResponse{
    string token = 1;
    string mensagem = 2;
    bool sucesso = 3;
}

message ConcluirAulaRequest{
    int64 id_aula = 1 [(google.api.field_behavior) = REQUIRED];
    string id_usuario = 2 [(google.api.field_behavior) = REQUIRED];
}

message ConcluirAulaResponse{
    string mensagem = 1;
    bool sucesso = 2;
}

message ConcluirModuloRequest{
    string id_modulo = 1 [(google.api.field_behavior) = REQUIRED];
    string id_usuario = 2 [(google.api.field_behavior) = REQUIRED];
}

message ConcluirModuloResponse{
    string mensagem = 1;
    bool sucesso = 2;
}

message ListarModuloAulasRequest{
}

message ListarModuloAulasResponse{
    repeated ModuloAulaAluno modulo_aulas = 1;
    string mensagem = 2;
    bool sucesso = 3;
}

message ModuloAulaAluno{
   string id_modulo = 1;
   repeated Aula aulas = 2 ;
}

message Aula{
    string id = 1;
    bool status = 2;
}

message GetUsuarioPeloEmailRequest{
    string email =  1 [(google.api.field_behavior) = REQUIRED];
}

message GetUsuarioPeloEmailResponse{
    Usuario usuario = 1;
    string mensagem = 2;
    bool sucesso = 3;
}

message Usuario{
    string id = 1;
    string email = 2;
    string nome = 3;
    google.protobuf.Timestamp criado_em = 4;
}

message AtualizarSenhaRequest {
    string id = 1 [(google.api.field_behavior) = REQUIRED];
    string senha = 2 [(google.api.field_behavior) = REQUIRED];
}

message AtualizarSenhaResponse{
    string mensagem = 2;
    bool sucesso = 3;
}

message GerarProvaRequest{
    string id_modulo = 1 [(google.api.field_behavior) = REQUIRED];
}

message GerarProvaResponse{
    string mensagem = 1;
    bool sucesso = 2;
}

message GetProvaGeradaRequest{
    string id_modulo = 1;
}

message GetProvaGeradaResponse{
    Prova prova = 1;
    string mensagem = 2;
    bool sucesso = 3;
}

message Prova {
    string tituloProva = 1;
    repeated Questao questoes = 2;
}

message Questao {
    int32 numQuestao = 1;
    string enunciado = 2;
    repeated string opcoes = 3;
}


message CorrigirProvaRequest{
    string id_modulo = 1 [(google.api.field_behavior) = REQUIRED];
    string provaRespondida = 2 [(google.api.field_behavior) = REQUIRED];
}

message CorrigirProvaResponse{
    ProvaCorrigida provaCorrigida = 1;
    string mensagem = 2;
    bool sucesso = 3;
}

message GetProvaCorrigidaRequest{
    string id_modulo = 1 [(google.api.field_behavior) = REQUIRED];
}

message GetProvaCorrigidaResponse{
    string tituloProva = 1;
    repeated QuestaoCorrigida questoesCorrigidas = 2;
    int32 nota = 3;
    string mensagem = 4;
    bool sucesso = 5;
}

message ProvaRespondida {
  string tituloProva = 1;
  repeated QuestaoRespondida questoesRespondidas = 2;
}

message QuestaoRespondida {
  int32 numQuestao = 1;
  string enunciado = 2;
  repeated string opcoes = 3;
  int32 respostaUsuario = 4;
}


message ProvaCorrigida {
  string tituloProva = 1;
  repeated QuestaoCorrigida questoesCorrigidas = 2;
  int32 nota = 3;
}

message QuestaoCorrigida {
  int32 numQuestao = 1;
  string enunciado = 2;
  repeated string opcoes = 3;
  int32 resposeCorreta = 4;
  int32 respostaUsuario = 5;
  string feedback = 6;
}